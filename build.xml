<project name="ydn-db" basedir="." default="compile-debug">
    <dirname property="ydn-db.dir" file="${ant.file.ydn-db}"/>
    <property name="work.dir" location="${ydn-db.dir}/.." />
    <property name="ydn-base.dir" location="${work.dir}/ydn-base" />
    <import file="${work.dir}/ydn/build.xml"/>
    <target name="compile-debug" description="compile JS">
        <mkdir dir="${ydn-db.dir}/jsc"/>
        <closure-compile compilationlevel="ADVANCED_OPTIMIZATIONS"
                         input="${ydn-db.dir}/js/ydn/db/storage.js"
                         input.dir="${ydn-db.dir}/js"
                         output.fn="${ydn-db.dir}/jsc/ydn-db.js">
            <extrapaths>
                <arg line='-p "${ydn-base.dir}/js"'/>
            </extrapaths>
        </closure-compile>
    </target>
    <target name="deps" description="list dependency files">
        <delete file="${ydn-db.dir}/js/deps.js"/>
        <calc-deps
                input.dir="${ydn-db.dir}/js"
                output.fn="${ydn-db.dir}/js/deps.js">
        </calc-deps>
    </target>
    <target name="jstd" description="print out jstd file for JS test driver">
        <jstd-gen base.dir="${ydn-db.dir}">
            <deps-options>
                <arg line='--path "${ydn.dir}/js"'/>
                <arg line='--path "${ydn-base.dir}/js"'/>
            </deps-options>
        </jstd-gen>
    </target>
    <target name="jsdoc" description="create document">
        <java jar="${jsdoc.dir}/jsrun.jar" fork="true" failonerror="true" logError="true">
            <arg line="${jsdoc.dir}/app/run.js" />
            <arg line="${ydn-db.dir}/js"/>
            <arg line="--verbose"/>
            <arg line="--recurse=6"/>
            <arg line="--template=${jsdoc.dir}/templates/jsdoc"/>
            <arg line="--directory=${ydn-db.dir}/docs"/>
        </java>
    </target>
</project>