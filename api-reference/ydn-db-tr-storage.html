<h1 class="classTitle">Class ydn.db.tr.Storage</h1>

<p>
This class extends <code>ydn.db.conn.Storage</code> and provides robust parallel transaction queues.
</p>
<dl class="detailList">
  <dt class="heading">Extends:</dt>
  <dd>Super class constructor: <a href="https://sites.google.com/a/yathit.com/ydn-dev/api-reference/ydn-db-core">ydn.db.conn.Storage</a>.</dd>
</dl>
<table cellspacing="0" class="summaryTable">

  <caption>
    Class Summary
  </caption>
  <thead>
  <tr>
    <th>Constructor Attributes</th>
    <th>Constructor Name and Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td class="attributes">&nbsp;</td>

    <td class="nameDescription">

      <div class="fixedFont">
        <b><a href="#constructor">ydn.db.tr.Storage</a></b>(name, schema, option)
      </div>

      <div class="description">
        Create a suitable storage mechanism.
      </div>
    </td>
  </tr>
  </tbody>
</table>


<table cellspacing="0" class="summaryTable">
  <caption>
    Method Summary
  </caption>
  <thead>
  <tr>

    <th>Method Attributes</th>
    <th>Method Name and Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td class="attributes">&nbsp;</td>

    <td class="nameDescription">

      <div class="fixedFont">
        <b><a href="#transaction">transaction</a></b>(transaction_callback, store_names,
        mode, completed_event_handler)
      </div>

      <div class="description">
        Create isolated database transaction.
      </div>
    </td>
  </tr>
  </tbody>
</table>

<div class="sectionTitle">
  Method Detail
</div>

<a name="transaction"></a>

<div class="fixedFont">
  <b>transaction</b>(transaction_callback, store_names,
  mode, completed_event_handler)
</div>

<div class="description">
  Preform a isolated non-overlapping database transaction asynchronously. If invoke from base
<code>ydn.db.Storage</code> instance, this create a new transaction immediately. Subsequents call
from the <code>ydn.db.tr.Storage</code> create non-overlapping transaction.</div>

<dl class="detailList">
  <dt class="heading">Parameters:</dt>

  <dt><span class="light fixedFont">{!function(ydn.db.tr.IStorage: tx)}</span> <b>transaction_callback</b></dt>

  <dd>Transaction in callback function. The callback is invoked <code>ydn.db.tr.IStorage</code> instance.
    Use <code>tx.getTx()</code> to get active transaction object, which could be either of  <code>IDBTransaction</code>,
    <code>SQLTransaction</code>, or <code>localStorage</code> depending on runtime environment.
    It returns <code>null</code> when transaction is no longer active.
    <br/>
    Use <code>tx.transaction(...)</code> to create another transaction from the queue. The callback will
    be invoked when previous one is completed.
  </dd>

  <dt><span class="light fixedFont">{Array.<string>}</span> <b>store_names</b></dt>

  <dd>List of store name. If empty list, all stores are open.</dd>

  <dt><span class="light fixedFont">{string}</span> <b>mode</b></dt>

  <dd>Transaction mode: <code>readonly</code> (default) or <code>readwrite</code>.</dd>

  <dt><span class="light fixedFont">{function(string: type, *: event)}</span> <b>completed_event_handler</b></dt>

  <dd>Handle event for transaction <code>completed</code>, <code>error</code> or <code>abort</code> event type.
    If provided, handler will be called once and only once immediately after the transacting become
    inactive. </dd>

  <dt><span class="light fixedFont">{...}</span> <b>opt_var_args</b></dt>

  <dd>Optional variable arguments pass back to <code>transaction_callback</code> prepending argument <code>tx</code></dd>

  <br>
  The following managed transaction is only applicable to subclass <a
    href="https://sites.google.com/a/yathit.com/ydn-dev/api-reference/ydn-db-storage">ydn.db.Storage</a>
<pre>for (var i = 1; i &lt;= 3; i++) {
  console.log('Requesting to update player ' + i);
  db.transaction(function increaseHealth10(i, tx) {
    console.log('Updating player ' + i);
    var key = db.key('player', i);
    key.get().success(function(p1) {
      print_player(p1);
      p1.health += 10;
      key.put(p1).success(function(p1id) {
        console.log('Player ' + p1id + ' updated.');
      })
    })
  }, ['player'], undefined, i)
}</pre>


</dl>
